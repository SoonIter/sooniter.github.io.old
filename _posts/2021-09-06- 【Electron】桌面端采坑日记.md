---
layout:     post
title:      【Electron】桌面端踩坑日记
subtitle:   
date:       2021-09-06
author:     YeanSe
header-img: 
catalog: true
tags:
    - Electron
---

# 环境搭建

## 1.原生环境

**坑: electron安装不完整，有损坏。----> 使用cnpm install electron**

```shell
npm init -y
cnpm install electron 或用一个全局兜一下底 cnpm install electron -g
之后手动添加 main.js index.html文件
在package.json中添加
"main": "background.js",
```

## 2.vue环境

**坑：vue-cli Ui 安装插件不完整，被墙，使用手动 **

```javascript
通过 vue-cli 新建项目后
cnpm electron
vue add electron-builder
```



# preload.js预加载

特殊性：不要直接调用electron的api！！electron的api和node有些许关系，所以并不是直接在渲染层起作用，也不是原生html中就可以调用的。

electron实现页面=>桌面端的功能扩展，主要通过**预加载**一个node的js文件完成。

通过它可以将api绑定到`window.electron`上，完成网页 -> 桌面端应用的完美跨越。

```javascript
//preload.js
const { contextBridge, ipcRenderer } = require('electron')
const path = require('path')

contextBridge.exposeInMainWorld('electron', {
  startDrag: (fileName) => {
    ipcRenderer.send('ondragstart', path.join(process.cwd(), fileName))
  }
  myAPI:()=>{
  
	}
	/*your API here*/
})
```

```javascript
//background.js
import path from 'path'

function createWindow () {
		const mainWindow = new BrowserWindow({
      width: 800,
  	  height: 800,
    	webPreferences: {
      	preload: path.join(__dirname, 'preload.js'),
   		}
})
    /*
    坑1：__dirname，根目录，此时是指 /dist_electron
    坑2：preload路径必须是绝对路径
    */
```

